var
  FileName, Output: String;
  Fail, Pass: Integer;
begin
  for FileName in FindFiles({$macro CURRENT_DIRECTORY}, ['simba']) do
  begin
    if (FileName = {$macro CURRENT_FILE}) then
      Continue;

    WriteLn('Testing: ' + ExtractFileName(FileName));

    if RunScript(FileName, ['--silent=true'], Output) = 0 then
    begin
      WriteLn('Passed');

      Inc(Pass)
    end else
    begin
      WriteLn('Failed "' + Trim(Output) + '"');

      Inc(Fail);
    end;
  end;

  WriteLn();
  WriteLn(Format('Ran %d tests in %.2f seconds', [Pass + Fail, (GetTimeRunning() / 1000)]));
  WriteLn(Format('%3d / %d tests failed', [Fail, Pass + Fail]));
  WriteLn(Format('%3d / %d tests passed', [Pass, Pass + Fail]));
  WriteLn();

  if (Fail > 0) then
    raise 'Failed';
end.
